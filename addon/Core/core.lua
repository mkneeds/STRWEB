ni = ni or { secureload = %%SecureLoad%%,castdest = %%CastDest%%,webrequest = %%AsyncWebRequest%%,functions = {moveto = %%MoveTo%%,clickat = %%ClickAt%%,registercallback = %%RegisterCallback%%,auras = %%Auras%%,require = %%Require%%,getmapid = %%GetMapID%%,bestloc = %%BestLoc%%,combatreach = %%CombatReach%%,objectexists = %%ObjectExists%%,getom = %%GetOM%%,interact = %%Interact%%,item = %%Item%%,inventoryitem = %%InventoryItem%%,objectinfo = %%ObjectInfo%%,isfacing = %%IsFacing%%,isbehind = %%IsBehind%%,hasaura = %%HasAura%%,runtext = %%RunText%%,getdistance = %%GetDistance%%,lookat = %%LookAt%%,unitcreator = %%UnitCreator%%,settarget = %%SetTarget%%,stopmoving = %%StopMoving%%,unitdynamicflags = %%UnitDynamicFlags%%,unitflags = %%UnitFlags%%,creaturetype = %%CreatureType%%,cast = %%Cast%%,getspellid = %%GetSpellID%%,stopcasting = %%StopCasting%%,los = %%LoS%%,objectpointer = %%ObjectPointer%%,baseaddress = %%BaseAddress%%,objecttransport = %%ObjectTransport%%,objectfacing = %%ObjectFacing%%,resetlasthardwareaction = %%ResetLastHardwareAction%%,callprotected = %%CallProtected%%,webrequest = %%WebRequest%%,getrandomnamefor = %%GetRandomNameFor%%,loadcontent = %%LoadContent%%,savecontent = %%SaveContent%%,getbasefolder = %%GetBaseFolder%%,getprofilesfor = %%GetProfilesFor%%,getpath = %%GetPath%%,freemaps = %%FreeMaps%%,getdescriptor = %%GetDescriptor%%,setcreaturetracking = %%SetCreatureTracking%%,setresourcetracking = %%SetResourceTracking%%,readdistance = %%WebRequest%%,open = %%Open%%,read = %%Read%%,toggleconsole = %%ToggleConsole%%,}}local a=GetLocale()=="ruRU"or false;local b;local function c(d)local e="SAFE"if e=="SAFE"then e=d(20)end;local f={"MoveForwardStop","MoveForwardStart","PetPassiveMode","ToggleSpellAutocast","TargetNearestEnemy","StrafeLeftStart","StrafeRightStart","AttackTarget","AssistUnit","CancelShapeshiftForm","CastShapeshiftForm","CastSpell","CastSpellByName","ClearTarget","PetAttack","TargetNearestFriend","TargetNearestEnemy","TargetLastTarget","TargetLastEnemy","SpellStopCasting","SpellStopTargeting","CastSpellByID","ReloadUI"}if#f>0 then for g,h in pairs(f)do _G[h..e]=function(...)return ni.functions.callprotected(h,...)end end end end;if not ni.loaded then local i=CreateFrame("frame")i:SetScript("OnUpdate",function(self)local j=IsLinuxClient()if j then ni.castdest=j;self:Hide()end end)local k={}local function l(...)local m=select('#',...)return setmetatable({...},{__len=function()return m end})end;local function n(o)if not o:find(".lua")and not o:find(".enc")then o=o..".lua"end;if not k[o]then k[o]=l(ni.functions.require(o))end;return unpack(k[o])end;local p=ni.functions.getbasefolder()local q=n(p.."addon\\core\\json.enc")ni.C_Timer=n(p.."addon\\core\\c_timer.enc")local function r()local function s(t)local u=ni.functions.loadcontent(t)if type(u)=="string"then if u:match('^{(.*)}$')then return q.decode(u)elseif u~=""then ni.C_Timer.After(3,function()message("\nThe configuration file was reseted,\nbecause the file was corrupted!")end)end end;return n(p.."addon\\core\\vars.enc")end;local t=p.."addon\\settings\\"..UnitName("player").."_"..GetRealmName()..".json"ni.vars=s(t)ni.vars.elvui=b;ni.vars.profiles.enabled=false;ni.vars.profiles.genericenabled=false;ni.vars.profiles.delay=0;ni.vars.combat.started=UnitAffectingCombat("player")ni.vars.locale=GetLocale()ni.vars.combat.counter=0;ni.vars.build=select(4,GetBuildInfo())ni.utils=n(p.."addon\\core\\utils.enc")ni.strongrand=n(p.."addon\\core\\mwcrand.enc")ni.debug=n(p.."addon\\core\\debug.enc")ni.memory=n(p.."addon\\core\\memory.enc")ni.rotation=n(p.."addon\\core\\rotation.enc")ni.bootstrap=n(p.."addon\\core\\bootstrap.enc")ni.tables=n(p.."addon\\core\\tables.enc")ni.drtracker=n(p.."addon\\core\\drtracker.enc")ni.utils.require=n;ni.utils.json=q;ni.utils.savesetting=function(v,w)if type(w)=="table"then w=q.encode(w)end;ni.functions.savecontent(p.."addon\\Settings\\"..v,w)end;ni.utils.getsettings=function(v)local u=ni.functions.loadcontent(p.."addon\\Settings\\"..v)return u and q.decode(u)or{}end;ni.lib={}ni.lib.IncomingHeals=n(p.."addon\\core\\libs\\IncomingHeals.enc")ni.lib.LibStub=n(p.."addon\\core\\libs\\LibStub.enc")ni.lib.CallbackHandler=n(p.."addon\\core\\libs\\CallbackHandler-1.0.enc")ni.lib.LibDataBroker=n(p.."addon\\core\\libs\\LibDataBroker-1.1.enc")ni.lib.LibDBIcon=n(p.."addon\\core\\libs\\LibDBIcon-1.0.enc")ni.lib.elvui=n(p.."addon\\core\\libs\\ElvUI_Skins.enc")ni.listener=n(p.."addon\\core\\listener.enc")ni.unit=n(p.."addon\\core\\unit.enc")ni.player=n(p.."addon\\core\\player.enc")ni.spell=n(p.."addon\\core\\spell.enc")ni.stuff=n(p.."addon\\core\\stuff.enc")ni.frames,ni.combatlog,ni.delayfor,ni.icdtracker,ni.events=n(p.."addon\\core\\frames.enc")ni.power=n(p.."addon\\core\\power.enc")ni.rune=n(p.."addon\\core\\rune.enc")ni.healing,ni.tanks=n(p.."addon\\core\\healing.enc")ni.members=n(p.."addon\\core\\members.enc")ni.objects,ni.objectmanager=n(p.."addon\\core\\objectmanager.enc")ni.stopcastingtracker=n(p.."addon\\core\\stopcastingtracker.enc")ni.ttd=n(p.."addon\\core\\timetodie.enc")ni.classes=n(p.."addon\\core\\classes.enc")ni.toolkit=n(p.."addon\\core\\toolkit.enc")ni.main=n(p.."addon\\core\\mainui.enc")ni.GUI=n(p.."addon\\core\\gui.enc")_=n(p.."addon\\core\\utils\\ItemID.enc")_=n(p.."addon\\core\\utils\\LootRoll.enc")local function x(y)local z=""for A=1,y do z=z..string.char(ni.strongrand.generate(97,122))end;return z end;local B={}ni.getrandomname=function()local o=x(20)while tContains(B,o)do o=x(20)end;table.insert(B,o)return o end;ni.showstatus=function(C,D)if D then ni.frames.floatingtext:message("\124cff00ff00"..C)else ni.frames.floatingtext:message("\124cffff0000"..C)end end;ni.toggleprofile=function(C)local E=false;if ni.vars.profiles.active==C then ni.vars.profiles.enabled=not ni.vars.profiles.enabled;if ni.vars.profiles.enabled==false then E=true end else E=true;ni.vars.profiles.enabled=true;ni.vars.profiles.active=C end;if E then if ni.rotation.profile[ni.rotation.lastprofile]then if ni.rotation.profile[ni.rotation.lastprofile].unload then ni.rotation.profile[ni.rotation.lastprofile]:unload()end;if ni.rotation.profile[ni.rotation.lastprofile].destroyGUI then ni.rotation.profile[ni.rotation.lastprofile]:destroyGUI()end end end;if ni.vars.profiles.enabled then if ni.rotation.profile[C]then if ni.rotation.profile[C].load then ni.rotation.profile[C]:load()end;if ni.rotation.profile[C].createGUI then ni.rotation.profile[C]:createGUI()end end end;if ni.rotation.lastprofile~=C then ni.rotation.lastprofile=C end;ni.showstatus(C,ni.vars.profiles.enabled)end;ni.togglegeneric=function(C)local E=false;if ni.vars.profiles.generic==C then ni.vars.profiles.genericenabled=not ni.vars.profiles.genericenabled;if ni.vars.profiles.genericenabled==false then E=true end else E=true;ni.vars.profiles.genericenabled=true;ni.vars.profiles.generic=C end;if E then if ni.rotation.profile[ni.rotation.lastgeneric]then if ni.rotation.profile[ni.rotation.lastgeneric].unload then ni.rotation.profile[ni.rotation.lastgeneric]:unload()end;if ni.rotation.profile[ni.rotation.lastgeneric].destroyGUI then ni.rotation.profile[ni.rotation.lastgeneric]:destroyGUI()end end end;if ni.vars.profiles.genericenabled then if ni.rotation.profile[C]then if ni.rotation.profile[C].load then ni.rotation.profile[C]:load()end;if ni.rotation.profile[C].createGUI then ni.rotation.profile[C]:createGUI()end end end;if ni.rotation.lastgeneric~=C then ni.rotation.lastgeneric=C end;ni.showstatus(C,ni.vars.profiles.genericenabled)end;ni.updatefollow=function(D)if D then if a then ni.frames.floatingtext:message("Авто следование: \124cff00ff00Включено")else ni.frames.floatingtext:message("Auto follow: \124cff00ff00Enabled")end else if a then ni.frames.floatingtext:message("Авто следование: \124cffff0000Выключено")else ni.frames.floatingtext:message("Auto follow: \124cffff0000Disabled")end end end;ni.getspellidfromactionbar=function()local F=GetMouseFocus():GetName()if string.match(F,"Button")then local G=_G[F]local H=ActionButton_GetPagedID(G)or ActionButton_CalculateAction(G)or G:GetAttribute("action")or 0;if HasAction(H)then local I,J,_,K=GetActionInfo(H)if I=="spell"then return K~=nil and K or J end end end end;local L=UnitGUID;function UnitGUID(M)local N=L(M)if not N and(M=="player"or M=="0x0")then return"0x0"end;return N end;ni.functionsregistered=function()return %%ToggleConsole%%~=nil end;ni.frames.main:SetScript("OnUpdate",ni.frames.OnUpdate)ni.frames.main:SetScript("OnEvent",ni.frames.OnEvent)c(x) if ni.vars["global"] then _G[ni.vars["global"]] = ni; end ni.functions.savecontent(t,q.encode(ni.vars))end;b=select(4,GetAddOnInfo("ElvUI"))==1; r() ni.loaded = true end